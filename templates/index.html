<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SleepCoach.AI - Uyku Sağlığı Risk Analizi</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/onnxruntime-web/1.14.0/ort.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="/static/css/styles.css">

    <style>
    /* Üst bar (değerlendirme sayfası) */
    .assess-nav{
      position:sticky; top:0; z-index:1000;
      background:rgba(255,255,255,.9);
      backdrop-filter:saturate(180%) blur(10px);
      border-bottom:1px solid #eef;
      box-shadow:0 6px 18px rgba(17,24,39,.06);
    }
    .assess-nav .inner{
      max-width:1200px; margin:0 auto; padding:12px 20px;
      display:flex; align-items:center; justify-content:space-between; gap:14px;
    }

    /* Marka */
    .assess-brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800; font-size:20px; color:#0f172a;
      padding:8px 14px; border-radius:14px;
      background:linear-gradient(180deg, rgba(255,255,255,.8), rgba(255,255,255,.6));
      box-shadow:0 10px 24px rgba(10,16,34,.08);
    }
    .assess-brand .dot{ color:#6c63ff; }

    /* Aksiyon butonları */
    .assess-actions{ display:flex; align-items:center; gap:10px; }
    .sc-btn{
      height:38px; padding:0 14px; border-radius:10px; font-weight:600; cursor:pointer;
      display:inline-flex; align-items:center; gap:8px; border:1px solid #e5e7eb; background:#fff;
      transition:transform .16s, box-shadow .16s, background .2s, color .2s;
    }
    .sc-btn:active{ transform:translateY(1px); }
    .sc-btn-outline{ background:transparent; color:#3b2fe0; border:1px solid rgba(59,47,224,.25); }
    .sc-btn-outline:hover{ background:rgba(59,47,224,.06); }
    .sc-btn-primary{
      background:linear-gradient(135deg,#6c63ff,#8d7bff); color:#fff; border:0;
      box-shadow:0 8px 22px rgba(108,99,255,.25);
    }
    .sc-btn-primary:hover{ box-shadow:0 10px 28px rgba(108,99,255,.33); }
    </style>

</head>
<!-- Alarm Overlay -->
<div id="alarmOverlay" class="alarm-overlay" style="display:none;">
  <div class="alarm-modal">
    <div class="alarm-bell">🔔</div>
    <h3>Alarm</h3>
    <p id="alarmOverlayText" style="margin:6px 0 14px;"></p>
    <div class="alarm-actions">
      <button id="alarmStopBtn" class="predict-btn" style="background:#EF4444">Alarmı Kapat</button>
        <button id="alarmMuteBtn" class="predict-btn" style="background:#64748B">Sessize Al (1 dk)</button>
        <button id="alarmSnoozeBtn" class="predict-btn" style="background:#FFA726">Ertele (5 dk)</button>
    </div>
  </div>
</div>

<body>
    <!-- Üst Navigasyon -->
  <nav class="assess-nav assess-nav--ghost" aria-label="Üst gezinme">
  <div class="inner">
    <a class="assess-brand" href="/">
      <span style="font-size:18px">🌙</span>
      <span>SleepCoach.<span class="dot">AI</span></span>
    </a>

    <div class="assess-actions">
      <button class="sc-btn sc-btn-outline" type="button" onclick="history.back()">Geri Dön</button>
      <a class="sc-btn" href="/assistant">Bilgi Asistanı</a>
      <a class="sc-btn sc-btn-primary" href="/">Ana Sayfa</a>
    </div>
  </div>
</nav>

    <div class="container">
        <div class="header">
            <h1>SleepCoach.AI</h1>
            <p>AI Tabanlı Uyku Sağlığı Risk Analizi - Explainable AI ile</p>
        </div>

        <div class="main-content">
            <div class="input-section">
                <h2>Kişisel Bilgiler</h2>
                <form id="sleepForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="Gender">Cinsiyet</label>
                            <select id="Gender" name="Gender" required>
                                <option value="">Seçiniz</option>
                                <option value="Male">Erkek</option>
                                <option value="Female">Kadın</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="BMI_Category">BMI Kategorisi</label>
                            <select id="BMI_Category" name="BMI_Category" required>
                                <option value="">Seçiniz</option>
                                <option value="Normal Weight">Normal Kilo</option>
                                <option value="Normal">Normal</option>
                                <option value="Overweight">Kilolu</option>
                                <option value="Obese">Obez</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="Occupation">Meslek</label>
                        <select id="Occupation" name="Occupation" required>
                            <option value="">Seçiniz</option>
                            <option value="Accountant">Muhasebeci</option>
                            <option value="Doctor">Doktor</option>
                            <option value="Engineer">Mühendis</option>
                            <option value="Lawyer">Avukat</option>
                            <option value="Nurse">Hemşire</option>
                            <option value="Sales Representative">Satış Temsilcisi</option>
                            <option value="Salesperson">Satış Elemanı</option>
                            <option value="Scientist">Bilimci</option>
                            <option value="Software Engineer">Yazılım Mühendisi</option>
                            <option value="Teacher">Öğretmen</option>
                        </select>
                    </div>

                    <div class="form-group slider-group">
                        <label for="Age">Yaş: <span id="AgeValue" class="slider-value">35</span></label>
                        <input type="range" id="Age" name="Age" min="18" max="80" value="35" class="slider">
                    </div>

                    <div class="form-group slider-group">
                        <label for="Sleep_Duration">Uyku Süresi (saat): <span id="Sleep_DurationValue" class="slider-value">7.5</span></label>
                        <input type="range" id="Sleep_Duration" name="Sleep_Duration" min="4" max="12" step="0.1" value="7.5" class="slider">
                    </div>

                    <div class="form-group slider-group">
                        <label for="Quality_of_Sleep">Uyku Kalitesi (1-10): <span id="Quality_of_SleepValue" class="slider-value">7</span></label>
                        <input type="range" id="Quality_of_Sleep" name="Quality_of_Sleep" min="1" max="10" step="1" value="7" class="slider">
                    </div>

                    <div class="form-group slider-group">
                        <label for="Physical_Activity_Level">Fiziksel Aktivite (1-10): <span id="Physical_Activity_LevelValue" class="slider-value">5</span></label>
                        <input type="range" id="Physical_Activity_Level" name="Physical_Activity_Level" min="1" max="10" step="1" value="5" class="slider">
                    </div>

                    <div class="form-group slider-group">
                        <label for="Stress_Level">Stres Seviyesi (1-10): <span id="Stress_LevelValue" class="slider-value">5</span></label>
                        <input type="range" id="Stress_Level" name="Stress_Level" min="1" max="10" step="1" value="5" class="slider">
                    </div>

                    <div class="form-group slider-group">
                        <label for="Heart_Rate">Kalp Atış Hızı (bpm): <span id="Heart_RateValue" class="slider-value">75</span></label>
                        <input type="range" id="Heart_Rate" name="Heart_Rate" min="50" max="120" value="75" class="slider">
                    </div>

                    <div class="form-group slider-group">
                        <label for="Daily_Steps">Günlük Adım (1000'ler): <span id="Daily_StepsValue" class="slider-value">8.0</span></label>
                        <input type="range" id="Daily_Steps" name="Daily_Steps" min="1" max="20" step="0.1" value="8.0" class="slider">
                    </div>

                    <div class="form-row">
                        <div class="form-group slider-group">
                            <label for="Systolic">Sistolik KB: <span id="SystolicValue" class="slider-value">120</span></label>
                            <input type="range" id="Systolic" name="Systolic" min="90" max="180" value="120" class="slider">
                        </div>

                        <div class="form-group slider-group">
                            <label for="Diastolic">Diastolik KB: <span id="DiastolicValue" class="slider-value">80</span></label>
                            <input type="range" id="Diastolic" name="Diastolic" min="50" max="120" value="80" class="slider">
                        </div>
                    </div>

                    <button type="submit" class="predict-btn" id="predictBtn">
                        <span class="btn-text">Risk Analizi Yap</span>
                        <span class="btn-loading" style="display: none;">Analiz ediliyor...</span>
                    </button>
                </form>
            </div>

            <div class="results-section">
                <div id="resultsContainer">
                    <div id="initialMessage" class="initial-message">
                        <div class="welcome-content">
                            <h3>🧠 SleepCoach.AI'ya Hoş Geldiniz</h3>
                            <div class="features">
                                <div class="feature-item">
                                    <div class="feature-icon">🤖</div>
                                    <div class="feature-text">
                                        <strong>AI Tahmin</strong><br>
                                        XGBoost modeli ile risk analizi
                                    </div>
                                </div>
                                <div class="feature-item">
                                    <div class="feature-icon">🔍</div>
                                    <div class="feature-text">
                                        <strong>Explainable AI</strong><br>
                                        SHAP ile açıklanabilir sonuçlar
                                    </div>
                                </div>
                                <div class="feature-item">
                                    <div class="feature-icon">⚡</div>
                                    <div class="feature-text">
                                        <strong>Real-time</strong><br>
                                        What-if analizi
                                    </div>
                                </div>
                                <div class="feature-item">
                                    <div class="feature-icon">🏥</div>
                                    <div class="feature-text">
                                        <strong>Güvenli</strong><br>
                                        Tarayıcıda çalışır, veri gizli
                                    </div>
                                </div>
                            </div>
                            <p class="start-text">Sol paneli doldurun ve risk analizinizi başlatın</p>
                        </div>
                    </div>

                    <div id="resultsContent" style="display: none;">
                        <div style="text-align:right; margin-bottom:8px;">
  <button id="saveAssessBtn" class="predict-btn" style="width:auto;padding:10px 14px; background:#6c63ff">
    Kaydet (Hesabıma)
  </button>
</div>

                        <div class="risk-display">
                            <div class="risk-meter">
                                <canvas id="riskChart" width="200" height="200"></canvas>
                                <div class="risk-percentage" id="riskPercentage">--%</div>
                            </div>
                            <div class="risk-level-container">
                                <div class="risk-level" id="riskLevel">Analiz Bekleniyor</div>
                                <div class="confidence-text" id="confidenceText"></div>
                            </div>
                        </div>

                        <div class="explanation-section">
                            <h3>🔍 Açıklama</h3>
                            <p id="explanationText">Risk analizi için formu doldurun.</p>
                        </div>

                        <div class="factors-section">
                            <div class="factors-grid">
                                <div class="factor-group risk-factors">
                                    <h4>🔺 Riski Artıran Faktörler</h4>
                                    <div id="riskFactorsList">
                                        <div class="factor-placeholder">Analiz bekleniyor...</div>
                                    </div>
                                </div>

                                <div class="factor-group protective-factors">
                                    <h4>🛡️ Koruyucu Faktörler</h4>
                                    <div id="protectiveFactorsList">
                                        <div class="factor-placeholder">Analiz bekleniyor...</div>
                                    </div>
                                </div>
                            </div>
                        </div>

<hr style="margin:24px 0;border:none;border-top:1px solid #eee;" />

<section id="alarmsSection" style="background:#fff;padding:20px;border-radius:12px;border:1px solid #eef;">
  <h3>⏰ Alarmlar</h3>

  <div style="display:flex;gap:12px;align-items:end;flex-wrap:wrap;margin:10px 0;">
    <div>
      <label>Etiket</label><br/>
      <input id="alarmLabel" type="text" value="Ekranları kapat" />
    </div>
    <div>
      <label>Saat</label><br/>
      <input id="alarmHour" type="number" min="0" max="23" value="23" />
    </div>
    <div>
      <label>Dakika</label><br/>
      <input id="alarmMinute" type="number" min="0" max="59" value="15" />
    </div>
    <div>
      <label>Günler</label><br/>
      <select id="alarmDays">
        <option value="127">Her gün</option>
        <option value="62">Hafta içi</option>
        <option value="65">Hafta sonu</option>
      </select>
    </div>
    <button id="createAlarmBtn" class="predict-btn" style="width:auto;padding:10px 16px;">Ekle</button>
    <button id="testAlarmBtn" class="predict-btn" style="width:auto;padding:10px 16px;background:#4A90E2;">Bildirim İzni / Test</button>
  </div>

  <ul id="alarmList" style="list-style:none;padding:0;margin:0;"></ul>

  <div id="adherenceStats" style="margin-top:12px;color:#666;"></div>
</section>



<div class="recommendations-section" id="recommendationsSection" style="display: none;">
    <h3>💡 Kişisel Öneriler</h3>
    <div class="current-risk-info">
        <span>Mevcut risk: <strong id="currentRiskValue">--%</strong></span>
        <span class="potential-improvement" id="potentialImprovement">Potansiyel iyileştirme: %-- azalma</span>
    </div>

    <div class="recommendations-list" id="recommendationsList">
        <div class="recommendation-placeholder">Öneriler yükleniyor...</div>
    </div>
</div>

                        <div class="shap-section">
                            <h3>📊 Feature Importance</h3>
                            <canvas id="shapChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>

                <div class="disclaimer">
                    <strong>⚠️ Önemli:</strong> Bu analiz sadece bilgilendirme amaçlıdır ve tıbbi tanı yerine geçmez.
                    Uyku sorunlarınız için mutlaka bir sağlık uzmanına danışın.
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>